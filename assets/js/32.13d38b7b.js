(window.webpackJsonp=window.webpackJsonp||[]).push([[32],{324:function(t,s,a){"use strict";a.r(s);var n=a(14),e=Object(n.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"糟糕的代码"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#糟糕的代码"}},[t._v("#")]),t._v(" 糟糕的代码")]),t._v(" "),s("details",{staticClass:"custom-block details"},[s("summary",[t._v("点击查看代码")]),t._v(" "),s("div",{staticClass:"language-csharp extra-class"},[s("pre",{pre:!0,attrs:{class:"language-csharp"}},[s("code",[t._v("   "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token return-type class-name"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("string")])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("GetGrossProfitReportWhere")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token class-name"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("string")])]),t._v(" startTime "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" request"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Params"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"StartTime"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token class-name"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("string")])]),t._v(" endTime "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" request"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Params"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"EndTime"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token class-name"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("string")])]),t._v(" ccids "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" request"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Params"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"ccids"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n            "),s("span",{pre:!0,attrs:{class:"token class-name"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("string")])]),t._v(" tempWhereSql "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("string")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Empty"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token class-name"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("string")])]),t._v(" navyInMonthWhere "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("string")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Empty"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token class-name"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("string")])]),t._v(" navyNotInMonthWhere "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("string")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Empty"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("string")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("IsNullOrEmpty")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("startTime"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("string")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("IsNullOrEmpty")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("endTime"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                tempWhereSql "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('@"\n                  AND ( ( type = 0\n                            AND OrderTime BETWEEN \'"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" startTime "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("@\"'\n                                          AND     '\"")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" endTime "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('@"\'\n                          )\n                        OR ( type = 1 )\n                        OR ( type = 2 )\n                        )"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                navyInMonthWhere "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("string")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("Format")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("\"NavyPaymentDate BETWEEN '{0}' AND  '{1}' AND PurchaseDate NOT BETWEEN '{0}' AND  '{1}'\"")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" startTime"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" endTime"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                navyNotInMonthWhere "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("string")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("Format")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("\"PurchaseDate BETWEEN '{0}' AND  '{1}' AND NavyPaymentDate NOT BETWEEN '{0}' AND  '{1}'\"")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" startTime"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" endTime"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                _csReturnOrderWhere "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('" AND CONVERT(datetime,Orders.Bill_Date) BETWEEN \'"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" startTime "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("\"' AND '\"")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" endTime "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"\'"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("string")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("IsNullOrEmpty")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("startTime"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                tempWhereSql "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('@"\n                  AND ( ( type = 0\n                          AND OrderTime >= \'"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" startTime "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('@"\'\n                          )\n                        OR ( type = 1 )\n                        OR ( type = 2 )\n                        )"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                _csReturnOrderWhere "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('" AND CONVERT(datetime,Orders.Bill_Date) >= \'"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" startTime "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"\'"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                navyInMonthWhere "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('@"NavyPaymentDate >= \'"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" startTime "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("@\"' AND PurchaseDate <= '\"")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" startTime "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('@"\'"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                navyNotInMonthWhere "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('@"PurchaseDate >= \'"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" startTime "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("@\"' AND NavyPaymentDate <= '\"")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" startTime "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('@"\'"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("string")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("IsNullOrEmpty")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("endTime"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                tempWhereSql "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('@"\n                  AND ( ( type = 0\n                          AND OrderTime <= \'"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" endTime "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('@"\'\n                          )\n                        OR ( type = 1 )\n                        OR ( type = 2 )\n                        )"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                _csReturnOrderWhere "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('" AND CONVERT(datetime,Orders.Bill_Date) <= \'"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" endTime "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"\'"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                navyInMonthWhere "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('@"NavyPaymentDate <= \'"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" endTime "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("@\"' AND PurchaseDate >= '\"")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" endTime "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('@"\'"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                navyNotInMonthWhere "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('@"PurchaseDate <= \'"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" endTime "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("@\"' AND NavyPaymentDate >= '\"")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" endTime "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('@"\'"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("string")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("IsNullOrEmpty")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("request"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Params"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"selFulfillmentChannel"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" request"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Params"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"selFulfillmentChannel"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"0"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                _sbWhere"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("Append")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"and FulfillmentChannel = \'"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" request"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Params"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"selFulfillmentChannel"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"\'"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("string")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("IsNullOrEmpty")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("request"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Params"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"selMarketplace"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" request"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Params"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"selMarketplace"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"0"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v('//_sbWhere.Append("and MarketplaceId = \'" + request.Params["selMarketplace"] + "\'");')]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("x_MarketplaceSiteBLL")]),t._v(" x_MarketplaceSiteBLL "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token constructor-invocation class-name"}},[t._v("x_MarketplaceSiteBLL")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token class-name"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")])]),t._v(" xMarketList "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" x_MarketplaceSiteBLL"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("GetMarketplaceList")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token class-name"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")])]),t._v(" market "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" xMarketList"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("FirstOrDefault")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("x "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" x"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("MarketplaceId "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" request"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Params"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"selMarketplace"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("market "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                    _sbWhere"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("Append")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token interpolation-string"}},[s("span",{pre:!0,attrs:{class:"token string"}},[t._v('$" and MSiteId =')]),s("span",{pre:!0,attrs:{class:"token interpolation"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token expression language-csharp"}},[t._v("market"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("MSiteId")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v(' "')])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ccids"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Length "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" ccids "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" ccids "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"-1"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                tempWhereSql "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('" AND CCID IN ("')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" ccids "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('")"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token class-name"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("string")])]),t._v(" feesFileds "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('" Commission , ProgramShippingCosts ProgramShippingCosts ,"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token class-name"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("string")])]),t._v(" billAccountSql "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("string")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Empty"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//使用对账单费用")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("string")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("IsNullOrEmpty")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("request"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Params"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"selectFees"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" request"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Params"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"selectFees"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("ToString")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"2"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                feesFileds "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('@" (case when b.CommissionQuantity=Orders.Quantity and b.CommissionQuantity>0 and Orders.Price>0 then (b.CommissionFee/b.CommissionQuantity/Orders.Price) else Commission end)Commission ,--佣金\n                                   (case when b.FulfillmentFeeQuantity=Orders.Quantity and b.FulfillmentFeeQuantity>0 then b.FulfillmentFee/b.FulfillmentFeeQuantity else ProgramShippingCosts end) ProgramShippingCosts ,--运费\n                                "')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                billAccountSql "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('@"  LEFT JOIN\n                                (\n                                "')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("GetBillAccountSql")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('@"\n                                ) b on Orders.AmazonOrderId=b.Order_Id AND Orders.SellerSKU=b.SKU "')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//显示采购成本")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token class-name"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("string")])]),t._v(" orderPurchaseCostSql "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("string")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Empty"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("string")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("IsNullOrEmpty")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("request"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Params"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"showPurchaseCost"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" request"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Params"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"showPurchaseCost"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("ToString")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"1"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                orderPurchaseCostSql "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("@\"   LEFT JOIN\n                                         ec_BaseInfo  on Orders.BID=ec_BaseInfo.BID and ec_BaseInfo.VariationMark in(0,1)\n                                         LEFT JOIN\n                                         ec_BaseInfoWithCom_Detail\n                                         on ec_BaseInfo.BID=ec_BaseInfoWithCom_Detail.BID\n                                         LEFT JOIN\n                                         Order_Purchase_Cost  on (CAST( Orders.shopID as varchar(5))+'*'+ Orders.AmazonOrderId)=Order_Purchase_Cost.Ebp_Bill_Code and ec_BaseInfoWithCom_Detail.CS_GoodID=Order_Purchase_Cost.Goods_Id\"")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token class-name"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("string")])]),t._v(" reportGroup "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" request"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Params"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"ReportGroup[]"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("??")]),t._v(" request"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Params"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"ReportGroup"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token class-name"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("decimal")])]),t._v(" costPriceBase "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1.45m")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//默认基数1.45")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("try")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                costPriceBase "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("decimal")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("Parse")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("request"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Params"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"costPriceType"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("ToString")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("catch")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Exception")]),t._v(" ex"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token class-name"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("string")])]),t._v(" innerJoinAGBSSql "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("string")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Empty"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 使用AGBS下单时间统计")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token class-name"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("string")])]),t._v(" strSpecialFields "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("string")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Empty"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 特殊查询字段")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("string")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("IsNullOrEmpty")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("request"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Params"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"orderTimeType"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" request"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Params"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"orderTimeType"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("ToString")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"1"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                strSpecialFields "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('",Orders_agbs.Bill_Date AS PurchaseDate"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                innerJoinAGBSSql "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('" INNER JOIN Orders_agbs ON Orders.shopID = Orders_agbs.shopID AND Orders.AmazonOrderId = Orders_agbs.OrderId "')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                strSpecialFields "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('",PurchaseDate"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token class-name"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("bool")])]),t._v(" excludeDiscount "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" request"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Params"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("AllKeys"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("Contains")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"ExcludeDiscount"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" request"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Params"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"ExcludeDiscount"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"true"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("?")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n            "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 默认方案及新旧方案成本取值")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token class-name"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("string")])]),t._v(" strCostPrice "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("string")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Empty"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token class-name"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("string")])]),t._v(" strOtherFileds "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("string")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Empty"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token class-name"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("string")])]),t._v(" strInitTable "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("string")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Empty"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n            "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("TryParse")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("request"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Params"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"schemeType"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("out")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")])]),t._v(" schemeType"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("switch")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("schemeType"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("case")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n                    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                        strInitTable "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('" Orders WITH (NOLOCK)"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                        strCostPrice "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token interpolation-string"}},[s("span",{pre:!0,attrs:{class:"token string"}},[t._v("$@\"  CASE WHEN(CASE WHEN TYPE = 0 THEN PurchaseDate ELSE CONVERT(datetime, Orders.Bill_Date) END) >= '2022-07-01 00:00:00'\n\n                                                    THEN\n                                                    (\n                                                        CASE WHEN TYPE = 1\n                                                            THEN CostPrice * (CASE WHEN OrderType IN (2,3) THEN 1 ELSE 0.25 END)\n                                                            ELSE CostPrice\n                                                            END\n                                                    )\n\n                                                    ELSE\n                                                    (CASE WHEN DATEPART(YEAR, (CASE WHEN TYPE = 0 THEN PurchaseDate ELSE Orders.Bill_Date END)) > 2019\n\n                                                        THEN CostPrice * 1.45 ELSE CostPrice * 1.75\n\n                                                        END) /")]),s("span",{pre:!0,attrs:{class:"token interpolation"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token expression language-csharp"}},[t._v(" costPriceBase ")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('\n                                        END"')])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n                        strOtherFileds "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token interpolation-string"}},[s("span",{pre:!0,attrs:{class:"token string"}},[t._v("$@\" ,(CASE WHEN(CASE WHEN TYPE = 0 THEN PurchaseDate ELSE CONVERT(datetime, Orders.Bill_Date) END) >= '2022-07-01 00:00:00'\n\n                                                    THEN\n                                                    (\n                                                        CASE WHEN OrderType IN (2,3,4)\n\t\t\t\t\t\t\t                                            THEN 0\n\t\t\t\t\t\t\t                                            ELSE OrderRemovalFee * ExchangeRate\n\t\t\t\t\t\t\t                                            END\n                                                    )\n                                                    ELSE OrderRemovalFee * ExchangeRate\n                                                END) AS OrderRemovalFee\"")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n                    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("break")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("case")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("case")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n                    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                        strInitTable "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" schemeType "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("?")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('" OrdersWithP5 AS Orders WITH (NOLOCK)"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('" OrdersWithP3 AS Orders WITH (NOLOCK)"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                        strCostPrice "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" schemeType "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n                            "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 旧方案（E价成本/1.75），20220701之前使用系统已有成本，之后使用当前账套实时成本")]),t._v("\n                            "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("?")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token interpolation-string"}},[s("span",{pre:!0,attrs:{class:"token string"}},[t._v("$@\"  CASE WHEN(CASE WHEN TYPE = 0 THEN PurchaseDate ELSE CONVERT(datetime, Orders.Bill_Date) END) >= '2022-07-01 00:00:00'\n\n                                                    THEN\n                                                    (\n                                                       NewCostPrice / ")]),s("span",{pre:!0,attrs:{class:"token interpolation"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token expression language-csharp"}},[t._v(" costPriceBase ")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("\n                                                    )\n\n                                                    ELSE\n                                                    (CASE WHEN DATEPART(YEAR, (CASE WHEN TYPE = 0 THEN PurchaseDate ELSE Orders.Bill_Date END)) > 2019\n\n                                                        THEN CostPrice * 1.45 ELSE CostPrice * 1.75\n\n                                                        END) /")]),s("span",{pre:!0,attrs:{class:"token interpolation"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token expression language-csharp"}},[t._v(" costPriceBase ")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('\n                                        END"')])]),t._v("\n                                        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 新方案（C价成本），20220701之前当前账套实时成本，之后使用使用系统已有成本")]),t._v("\n                                        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token interpolation-string"}},[s("span",{pre:!0,attrs:{class:"token string"}},[t._v("$@\"  CASE WHEN(CASE WHEN TYPE = 0 THEN PurchaseDate ELSE CONVERT(datetime, Orders.Bill_Date) END) >= '2022-07-01 00:00:00'\n\n                                                    THEN\n                                                    (\n                                                        CASE WHEN TYPE = 1\n                                                            THEN CostPrice * (CASE WHEN OrderType IN (2,3) THEN 1 ELSE 0.25 END)\n                                                            ELSE CostPrice\n                                                            END\n                                                    )\n\n                                                    ELSE\n                                                    (\n                                                        CASE WHEN TYPE = 1\n                                                            THEN NewCostPrice * (CASE WHEN OrderType IN (2,3) THEN 1 ELSE 0.25 END)\n                                                            ELSE NewCostPrice\n                                                            END\n                                                    )\n                                        END\"")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n                        strOtherFileds "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" schemeType "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("?")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token interpolation-string"}},[s("span",{pre:!0,attrs:{class:"token string"}},[t._v('$@" ,OrderRemovalFee * ExchangeRate AS OrderRemovalFee"')])]),t._v("\n                                                         "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token interpolation-string"}},[s("span",{pre:!0,attrs:{class:"token string"}},[t._v('$@" , (\n\t\t\t\t\t\t                                            CASE WHEN OrderType IN (2,3,4)\n\t\t\t\t\t\t\t                                            THEN 0\n\t\t\t\t\t\t\t                                            ELSE OrderRemovalFee * ExchangeRate\n\t\t\t\t\t\t\t                                            END\n\t\t\t\t\t\t                                            ) AS OrderRemovalFee"')])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n                    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("break")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("default")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("break")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n            "),s("span",{pre:!0,attrs:{class:"token class-name"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("string")])]),t._v(" strSql "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('@"\n            SELECT  CASE WHEN type = 1 THEN -1 * temp.Quantity ELSE temp.Quantity END Quantity,\n                    CASE WHEN type = 1 THEN temp.Quantity ELSE 0 END ReturnQuantity,\n                    CASE WHEN type = 0 THEN temp.Quantity ELSE 0 END SalesQuantity,\n                    dbo.d_shopinfo.shopName ,\n                    dbo.x_platForm.pName AS PlatFormName ,\n                    temp.ShopId ,\n                    dbo.d_shopinfo.blongsPlatform AS PlatFormId ,\n                    dbo.d_shopinfo.Comp_id ,\n                    OrderTime ,\n                                    --dbo.p_products.proName AS Title ,\n                                    --ISNULL(a.Quantity, 0) AS ReturnQuantity ,\n                                    --temp.Price * ISNULL(a.Quantity, 0) AS ReturnTotalPrice ,\n                                                --temp.GrossProfitMargin ,\n                                                --temp.GrossProfit ,\n                    temp.WDOrderID ,\n                    (CASE WHEN (type =1 and AfterTaxTotalPrice - AfterTaxCostPrice>0) THEN 0 ELSE AfterTaxTotalPrice - AfterTaxCostPrice END) AS GrossProfit ,\n                    OrderId ,\n                    SKU ,\n                    ReturnMoney ,\n                    OrderRemovalFee ,\n                    --ReturnCostPrice ,\n                    MarketplaceId ,\n                    MSiteId ,\n                    FulfillmentChannel ,\n                    AfterTaxTotalPrice ,\n                    AfterTaxCostPrice ,\n                    CASE WHEN type = 1 THEN 0\n                         ELSE temp.TotalPrice\n                    END TotalPrice ,\n                        temp.TotalPrice AS YTotalPrice ,\n                    TotalAdditionalCostPrice ,\n                    AdditionalCostPrice ,\n                    temp.ProgramShippingCosts ,\n                    temp.VolumeCost ,\n                    CASE WHEN temp.TotalPrice - temp.ReturnMoney = 0 THEN 0\n                         ELSE CASE WHEN type = 1 THEN 0\n                                   ELSE ( AfterTaxTotalPrice - AfterTaxCostPrice )\n                                        / ( temp.TotalPrice - temp.ReturnMoney )\n                              END\n                    END AS GrossProfitMargin ,\n                    temp.CostPrice ,\n                    temp.BID ,\n                    NAVYPrice ,\n                    type ,\n                    Cname,\n                    CCID,\n                    AfterReturnShippingCosts,{2}\n                    Bill_Date,\n                    PurchaseCost\n                    ,TaxRate\n                    ,temp.Commission\n                    ,temp.CostDiscount\n\t\t\t        ,temp.ExchangeRate\n\t\t\t        ,temp.NewGoodsDiscount\n                    ,temp.QualityDiscount\n                    ,temp.SupportDiscount\n                    ,temp.SpecialDiscount\n                    ,temp.FixedFee\n                    ,temp.IsNAVY\n                    ,temp.OrderType\n                    ,ReturnManagementFee\n\t\t            {0}\n            FROM    ( SELECT\n                                ec_CustomCategories1.CCID,\n                                ec_CustomCategories1.Cname,\n                                temp.TotalPrice ,\n                                SUM(temp.Quantity) AS Quantity ,\n                                temp.SellerSKU AS SKU ,\n                                temp.shopID ,\n                                temp.PurchaseDate AS OrderTime ,\n                                temp.CostPrice * SUM(temp.Quantity) AS CostPrice ,\n                                temp.WDOrderID ,\n                                temp.AmazonOrderId AS OrderId ,\n                                --SUM(ISNULL(wd_cs_ReturnOrder.Sub_Amt, 0)) Sub_Amt ,\n                                --SUM(SingleCostPrice * wd_cs_ReturnOrder.Sub_Qty) AS ReturnCostPrice ,\n                                --( ( temp.TotalPrice - SUM(ISNULL(wd_cs_ReturnOrder.Sub_Amt,\n                                --                                 0)) ) * ExchangeRate\n                                --  * ( 1 - TaxRate / ( TaxRate + 1 ) - Commission ) ) AfterTaxTotalPrice ,\n                                --( ( SUM(temp.AdditionalCostPrice)\n                                --    + SUM(ProgramShippingCosts) + SUM(VolumeCost) )\n                                --  - SUM(SingleCostPrice * ISNULL(wd_cs_ReturnOrder.Sub_Qty,\n                                --                                 0)) ) AfterTaxCostPrice ,\n                                              --有水军的先扣除水军金额在算毛利\n                                SUM(temp.AfterTaxTotalPrice)\n                                - CAST(SUM(CASE NavyReasonType WHEN 6 THEN 0 ELSE NAVYPrice END) AS DECIMAL(18, 6)) AS AfterTaxTotalPrice ,\n                                (SUM(temp.AdditionalCostPrice)\n                                  + SUM(ProgramShippingCosts)\n                                  + SUM(VolumeCost)\n                                  + SUM(ReturnManagementFee)\n\t\t\t\t\t\t          + SUM(OrderRemovalFee)\n                                )AS AfterTaxCostPrice ,\n                                --如果是退单的要多算上运费，因为运费没有退回\n                                CASE WHEN temp.type = 1 THEN SUM(ProgramShippingCosts)\n                                     ELSE 0\n                                END AfterReturnShippingCosts ,\n                                    MAX(temp.MarketplaceId)AS MarketplaceId ,\n                                    MAX(temp.MSiteId)AS MSiteId ,\n                                    MAX(FulfillmentChannel) AS FulfillmentChannel  ,\n                                    SUM(temp.AdditionalCostPrice)\n                                    + SUM(ProgramShippingCosts) + SUM(VolumeCost) AS TotalAdditionalCostPrice ,\n                                SUM(ProgramShippingCosts) AS ProgramShippingCosts ,\n                                SUM(VolumeCost) AS VolumeCost ,\n                                SUM(temp.AdditionalCostPrice) AdditionalCostPrice ,\n                                temp.BID ,\n                                SUM(NAVYPrice) AS NAVYPrice ,\n                                temp.type ,\n                                SUM(ReturnMoney) AS ReturnMoney\n                                ,SUM(OrderRemovalFee) AS OrderRemovalFee\n                                ,{2}\n                                MAX(Bill_Date) Bill_Date,\n                                SUM(PurchaseCost) AS PurchaseCost\n                                ,TaxRate\n                                ,Commission\n                                ,MAX(temp.CostDiscount)AS CostDiscount\n\t\t\t\t\t\t\t,MAX(temp.ExchangeRate)AS ExchangeRate\n\t\t\t\t\t\t\t,MAX(temp.NewGoodsDiscount)AS NewGoodsDiscount\n                            ,MAX(temp.QualityDiscount)AS QualityDiscount\n                            ,MAX(temp.SupportDiscount)AS SupportDiscount\n                            ,MAX(temp.SpecialDiscount)AS SpecialDiscount\n                            ,SUM(temp.FixedFee)AS FixedFee\n                            ,MAX(temp.NavyReasonType)AS NavyReasonType\n                            ,MAX(temp.IsNAVY)AS IsNAVY\n                            ,MAX(OrderType) AS OrderType\n                            ,SUM(ReturnManagementFee)ReturnManagementFee\n                      FROM      ( SELECT    temp1.shopID ,\n                                            AmazonOrderId ,\n                                            (CASE type WHEN 2 THEN 0 ELSE TotalPrice END) TotalPrice,\n                                            ( (CASE type WHEN 2 THEN 0 ELSE temp1.TotalPrice END) * ( 1\n                                                                          - TaxRate\n                                                                          / ( TaxRate + 1 )\n                                                                          - Commission ) ) AfterTaxTotalPrice ,\n                                            (CASE type WHEN 2 THEN 0 ELSE Quantity END) Quantity,\n                                            SellerSKU ,\n                                            PurchaseDate ,\n                                            (CASE type WHEN 2 THEN 0 ELSE  temp1.CostPrice END) CostPrice,\n                                                                        --PublishID ,\n                                            WDOrderID ,\n                                            WDOrderDetID ,\n                                            BID ,\n                                            --wd_OrderDetaliGrossProfit.GoodsId ,\n                                            --( ( ( temp1.AdditionalCostPrice\n                                            --      * wd_OrderDetaliGrossProfit.CostPriceProportion )\n                                            --    + ( ISNULL(ProgramShippingCosts, 0)\n                                            --        / Quantity ) + ( ISNULL(VolumeCost, 0)\n                                            --                         / Quantity ) )\n                                            --  / wd_OrderDetaliGrossProfit.PackageQuantity ) AS SingleCostPrice ,\n                                            FulfillmentChannel ,\n                                            MarketplaceId ,\n                                            MSiteId ,\n                                            (CASE type WHEN 2 THEN 0 ELSE AdditionalCostPrice END) * Quantity AS AdditionalCostPrice ,\n                                            TaxRate ,\n                                            Commission ,\n                                            ISNULL((CASE WHEN type = 1 OR type = 2 THEN 0 ELSE ProgramShippingCosts END), 0) AS ProgramShippingCosts ,\n                                            ISNULL((CASE WHEN type = 1 OR type = 2 THEN 0 ELSE VolumeCost END) , 0) AS VolumeCost ,\n                                            ISNULL(NAVYPrice, 0)\n                                            * ExchangeRate AS NAVYPrice ,\n                                            type ,\n                                            (CASE type WHEN 2 THEN 0 ELSE ReturnMoney END) AS ReturnMoney,\n                                            (CASE type WHEN 2 THEN 0 ELSE ReturnManagementFee END) ReturnManagementFee,\n                                            (CASE type WHEN 2 THEN 0 ELSE OrderRemovalFee END) AS OrderRemovalFee,\n                                            Bill_Date,\n                                            (CASE type WHEN 2 THEN 0 ELSE ISNULL(PurchaseCost,0) END) * Quantity AS PurchaseCost\n                                            ,CostDiscount\n                                            ,ExchangeRate\n                                            ,NewGoodsDiscount\n                                            ,QualityDiscount\n                                            ,SupportDiscount\n                                            ,SpecialDiscount\n                                            ,(FixedFee * ExchangeRate * (CASE WHEN TYPE = 0 THEN 1 ELSE -1 END)) AS FixedFee\n                                            ,NavyReasonType\n                                            ,IsNAVY\n                                            ,OrderType\n                                      FROM      ( SELECT    Orders.ShopId ,\n                                                            AmazonOrderId ,\n                                                        TotalPrice\n                                                        * ExchangeRate AS TotalPrice ,\n                                                        Quantity ,\n                                                        SellerSKU ,\n                                                        --成本时间节点划分 2020之前按单价类型/1.75，2020之后按单价类型/1.45\n                                                        CONVERT(decimal(18,2),\n                                                                    (\n\t\t\t\t\t\t                                               "')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" strCostPrice "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('@"\n                                                                    )\n                                                                )AS CostPrice,\n                                                        WDOrderID ,\n                                                        WDOrderDetID ,\n                                                        Orders.BID ,\n                                                        FulfillmentChannel ,\n                                                        MarketplaceId ,\n                                                        MSiteId ,\n                                                        CONVERT(decimal(18,2),\n                                                                    (\n\t\t\t\t\t\t                                               "')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" strCostPrice "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('@"\n                                                                    )\n                                                                    * Orders.QualityDiscount * Orders.SupportDiscount * "')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("excludeDiscount "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("?")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"1"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Orders.CostDiscount * Orders.NewGoodsDiscount *  Orders.SpecialDiscount"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('@" + (FixedFee * ExchangeRate * (CASE WHEN TYPE=0 THEN 1 ELSE -1 END))\n                                                                )AS AdditionalCostPrice,\n                                                        TaxRate ,\n                                                        ExchangeRate ,\n                                                        "')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("excludeDiscount "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("?")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"1"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Orders.CostDiscount"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('@" AS CostDiscount,\n                                                        "')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("excludeDiscount "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("?")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"1"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Orders.NewGoodsDiscount"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('@" AS NewGoodsDiscount,\n                                                        "')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("excludeDiscount "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("?")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"1"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Orders.SpecialDiscount"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('@" AS SpecialDiscount,\n                                                        QualityDiscount,\n                                                        SupportDiscount,\n                                                        FixedFee,\n                                                      "')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" feesFileds "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('@"\n                                                        VolumeCost ,\n                                                         (CASE WHEN ("')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" navyInMonthWhere "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('@") THEN 2 ELSE type END) AS type ,\n                                                        ReturnMoney\n                                                        * ExchangeRate AS ReturnMoney,\n                                                        (\n\t\t\t\t\t                                        CASE WHEN type = 1 AND LEN(MarketplaceId) > 10\n\t\t\t\t\t\t\t                                    THEN (CASE WHEN OrderType = 1 THEN 0 ELSE ReturnMoney * 0.2 * Commission END)\n\t\t\t\t\t\t\t                                    ELSE 0\n\t\t\t\t\t\t\t                                    END\n\t\t\t\t\t                                     ) AS ReturnManagementFee\n                                                        "')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" strOtherFileds "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('@"\n                                                       , Orders.Bill_Date,\n                                                       "')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("string")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("IsNullOrEmpty")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("orderPurchaseCostSql"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("?")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"(ec_BaseInfoWithCom_Detail.PackageQuantity * Order_Purchase_Cost.CbPrice * (CASE WHEN TYPE=0 THEN 1 ELSE -1 END))"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"0"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('@" as PurchaseCost,\n                                                       (CASE WHEN ("')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" navyNotInMonthWhere "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('@") THEN 0 ELSE NavyAmount END) as NAVYPrice,\n                                                       (\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t   CASE WHEN ("')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" navyNotInMonthWhere "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('@")\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t   THEN 0\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t   ELSE\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t   (\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t      CASE WHEN NavyPaymentDate IS NOT NULL THEN 1 ELSE 0 END\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t   )\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t   END) as IsNAVY,\n                                                       OrderType,\n                                                       NavyPaymentDate,\n                                                       NavyReasonType\n                                                       {3}\n                                                  FROM  "')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" strInitTable "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('@"\n                                                 "')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" innerJoinAGBSSql "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('@"\n                                                 "')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" billAccountSql "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('@"\n                                                 "')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" orderPurchaseCostSql "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('@"\n                                                  WHERE     ( type = 1\n                                                          "')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" _csReturnOrderWhere "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('@"\n                                                        )\n                                                        OR type = 0\n                                            ) temp1\n                                ) AS temp\n                                INNER JOIN ec_CustomCategories_Item ON ec_CustomCategories_Item.BID = temp.BID AND ec_CustomCategories_Item.Type = 1\n                                INNER JOIN dbo.ec_CustomCategories ON ec_CustomCategories.CCID = ec_CustomCategories_Item.CCID\n                                INNER JOIN ec_CustomCategories ec_CustomCategories1 ON ec_CustomCategories1.CCID = ec_CustomCategories.ParentID\n                                --JOIN dbo.ec_BaseInfo ON ec_BaseInfo.BID = temp.BID\n                                --                        AND VariationMark = 2\n                                --LEFT JOIN ( SELECT  Ebp_Bill_Code ,\n                                --                    Goods_Id ,\n                                --                    SUM(Sub_Amt) Sub_Amt ,\n                                --                    SUM(Sub_Qty) Sub_Qty ,\n                                --                    MAX(OriginalShopId) OriginalShopId\n                                --            FROM    wd_cs_ReturnOrder\n                                --            GROUP BY Ebp_Bill_Code ,\n                                --                    Goods_Id\n                                --          ) wd_cs_ReturnOrder ON Ebp_Bill_Code = temp.AmazonOrderId\n                                --                                 AND OriginalShopId = temp.shopID\n                                --                                 AND Goods_Id = temp.GoodsId\n\t\t\t\t\t              {1}\n                      GROUP BY  temp.TotalPrice ,\n                                temp.Quantity ,\n                                temp.SellerSKU ,\n                                temp.shopID ,\n                                temp.PurchaseDate ,\n                                temp.CostPrice ,\n                                temp.WDOrderID ,\n                                temp.WDOrderDetID ,\n                                temp.AmazonOrderId ,\n                                    --temp.MarketplaceId ,\n                                    --FulfillmentChannel ,\n                                                            --AdditionalCostPrice ,\n                                {2}\n                                temp.BID ,\n                                temp.type,\n                                ec_CustomCategories1.CCID,\n                                ec_CustomCategories1.Cname\n                                ,TaxRate\n                                ,Commission\n                    ) temp\n                    INNER JOIN dbo.d_shopinfo ON dbo.d_shopinfo.shopID = temp.shopID\n                    INNER JOIN dbo.x_platForm ON dbo.x_platForm.PID = dbo.d_shopinfo.blongsPlatform\n                    "')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//勾选商品的时候")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("reportGroup"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("Contains")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"SKU"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v('//reportGroup += ",Title";')]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token preprocessor property"}},[t._v("#"),s("span",{pre:!0,attrs:{class:"token directive keyword"}},[t._v("region")]),t._v(" MyRegion")]),t._v("\n\n                "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v('//                strSql = @"')]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//                SELECT  DISTINCT")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//                        temp.TotalPrice ,")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//                        dbo.d_shopinfo.shopName ,")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//                        dbo.x_platForm.pName AS PlatFormName ,")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//                        temp.shopID ,")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//                        dbo.d_shopinfo.blongsPlatform AS PlatFormId ,")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//                        dbo.d_shopinfo.Comp_id ,")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//                        temp.PurchaseDate AS OrderTime ,")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//                        ISNULL(dbo.r_OrderReturns.ReturnMoney, 0) AS ReturnMoney ,")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//                        temp.FulfillmentChannel ,")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//                        temp.MarketplaceId ,")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//                        temp.AmazonOrderId ,")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//                        --GrossProfitMargin ,")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//                        --temp.GrossProfit ,")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//                        --CostPrice")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//                        TotalCostPrice ,")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//                        TotalGrossProfit ,")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//                        TotalGrossProfitMargin")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//                FROM      ( SELECT    dbo.wd_order_amazon.WDOrderID ,")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//                                    dbo.wd_order_amazon.shopID ,")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//                                    dbo.wd_order_amazon.OrderAmount AS TotalPrice ,")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//                                    dbo.wd_order_amazon.PurchaseDate ,")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//                                                    --ISNULL(dbo.r_OrderReturns.ReturnMoney,")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//                                                    --      0) AS ReturnMoney ,")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//                                    dbo.wd_order_amazon.AmazonOrderId ,")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//                                    FulfillmentChannel ,")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//                                    wd_order_amazon.MarketplaceId ,")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//                                    PublishID ,")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//                                    TotalCostPrice ,")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//                                    TotalGrossProfit ,")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//                                    TotalGrossProfitMargin")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//                                    --,")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//                                    --SUM(GrossProfitMargin) / COUNT(1) AS GrossProfitMargin ,")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//                                    --SUM(GrossProfit")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//                                    --    * ( dbo.wd_orderDet_amazon.QuantityOrdered")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//                                    --        - dbo.r_OrderReturnsDetail.Quantity )) AS GrossProfit ,")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//                                    --SUM(CostPrice")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//                                    --    * ( dbo.wd_orderDet_amazon.QuantityOrdered")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//                                    --        - dbo.r_OrderReturnsDetail.Quantity )) AS CostPrice")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//                            FROM      dbo.wd_order_amazon WITH ( NOLOCK )")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//                                    INNER JOIN dbo.wd_orderDet_amazon WITH ( NOLOCK ) ON dbo.wd_orderDet_amazon.WDOrderID = dbo.wd_order_amazon.WDOrderID")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//                                    JOIN p_Publish_Offer_Amazon ON p_Publish_Offer_Amazon.ShopID = wd_order_amazon.shopID")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//                                                                    AND p_Publish_Offer_Amazon.MarketplaceID = wd_order_amazon.MarketplaceId")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//                                                                    AND ISNULL(historySellerSKU,")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//                                                                    p_Publish_Offer_Amazon.SellerSKU) = wd_orderDet_amazon.SellerSKU")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//                                    --LEFT OUTER JOIN dbo.r_OrderReturns WITH ( NOLOCK ) ON dbo.r_OrderReturns.WdOrderId = dbo.wd_order_amazon.WDOrderID")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//                                    --                              AND dbo.r_OrderReturns.ShopId = dbo.wd_order_amazon.shopID")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//                                    --                              AND dbo.r_OrderReturns.type = 1")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//                                    --LEFT OUTER JOIN dbo.r_OrderReturnsDetail ON dbo.r_OrderReturnsDetail.OrderReturnsId = dbo.r_OrderReturns.OrderReturnsId")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//                                    --                              AND dbo.wd_orderDet_amazon.WDOrderDetID = dbo.r_OrderReturnsDetail.OrderDetailId")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//                            --WHERE     QuantityOrdered <> 0")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//                            --GROUP BY  dbo.wd_order_amazon.WDOrderID ,")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//                            --          dbo.wd_order_amazon.shopID ,")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//                            --          dbo.wd_order_amazon.BuyerName ,")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//                            --          dbo.wd_order_amazon.OrderAmount ,")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//                            --          dbo.wd_order_amazon.PurchaseDate ,")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//                            --          dbo.wd_order_amazon.AmazonOrderId ,")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//                            --          FulfillmentChannel ,")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//                            --          wd_order_amazon.MarketplaceId ,")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//                            --          PublishID")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//                            UNION ALL")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//                            SELECT    dbo.wd_order_ebay.WDOrderID ,")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//                                    dbo.wd_order_ebay.shopID ,")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//                                    dbo.wd_order_ebay.Total AS TotalPrice ,")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//                                    dbo.wd_order_ebay.CreatedTime AS PurchaseDate ,")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//                                    dbo.wd_order_ebay.OrderID AS AmazonOrderId ,")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//                                    '' FulfillmentChannel ,")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//                                    '' MarketplaceId ,")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//                                    PublishId ,")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//                                    TotalCostPrice ,")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//                                    TotalGrossProfit ,")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//                                    TotalGrossProfitMargin")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//                                    --,")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//                                    --SUM(GrossProfitMargin) / COUNT(1) AS GrossProfitMargin ,")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//                                    --SUM(GrossProfit * ( QuantityPurchased")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//                                    --                    - r_OrderReturnsDetail_1.Quantity )) AS GrossProfit ,")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//                                    --SUM(CostPrice * ( QuantityPurchased")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//                                    --                  - r_OrderReturnsDetail_1.Quantity )) AS CostPrice")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//                            FROM      dbo.wd_order_ebay WITH ( NOLOCK )")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//                                    INNER JOIN dbo.wd_orderDet_ebay WITH ( NOLOCK ) ON dbo.wd_orderDet_ebay.WDOrderID = dbo.wd_order_ebay.WDOrderID")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//                                    JOIN dbo.p_Publish ON p_Publish.ShopId = wd_order_ebay.shopID")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//                                                            AND p_Publish.ItemId = wd_orderDet_ebay.ItemID")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//                                    --LEFT OUTER JOIN dbo.r_OrderReturns AS r_OrderReturns_1")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//                                    --WITH ( NOLOCK ) ON r_OrderReturns_1.WdOrderId = dbo.wd_order_ebay.WDOrderID")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//                                    --                   AND r_OrderReturns_1.ShopId = dbo.wd_order_ebay.shopID")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//                                    --                   AND r_OrderReturns_1.type = 1")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//                                    --LEFT OUTER JOIN dbo.r_OrderReturnsDetail AS r_OrderReturnsDetail_1 ON r_OrderReturnsDetail_1.OrderReturnsId = r_OrderReturns_1.OrderReturnsId")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//                                    --                              AND dbo.wd_orderDet_ebay.WDOrderDetID = r_OrderReturnsDetail_1.OrderDetailId")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//                            --GROUP BY  dbo.wd_order_ebay.WDOrderID ,")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//                            --          dbo.wd_order_ebay.shopID ,")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//                            --          dbo.wd_order_ebay.Name ,")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//                            --          dbo.wd_order_ebay.Total ,")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//                            --          dbo.wd_order_ebay.CreatedTime ,")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//                            --          dbo.wd_order_ebay.OrderID ,")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//                            --          PublishId")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//                            UNION ALL")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//                            SELECT    dbo.wd_Order_PrestaShop.OrderPrestaShopId ,")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//                                    dbo.wd_Order_PrestaShop.ShopId ,")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//                                    dbo.wd_Order_PrestaShop.OrderTotal AS TotalPrice ,")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//                                    dbo.wd_Order_PrestaShop.OrderDate AS PurchaseDate ,")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//                                    dbo.wd_Order_PrestaShop.OrderId AS AmazonOrderId ,")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//                                    '' FulfillmentChannel ,")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//                                    '' MarketplaceId ,")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//                                    PublishID ,")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//                                    TotalCostPrice ,")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//                                    TotalGrossProfit ,")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//                                    TotalGrossProfitMargin")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//                                    --,")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//                                    --SUM(GrossProfitMargin) / COUNT(1) AS GrossProfitMargin ,")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//                                    --SUM(GrossProfit * ( QuantityPurchased")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//                                    --                    - r_OrderReturnsDetail_1.Quantity )) AS GrossProfit ,")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//                                    --SUM(CostPrice * ( QuantityPurchased")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//                                    --                  - r_OrderReturnsDetail_1.Quantity )) AS CostPrice")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//                            FROM      dbo.wd_Order_PrestaShop WITH ( NOLOCK )")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//                                    INNER JOIN dbo.wd_Order_PrestaShop_Item WITH ( NOLOCK ) ON dbo.wd_Order_PrestaShop_Item.OrderPrestaShopId = dbo.wd_Order_PrestaShop.OrderPrestaShopId")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//                                    JOIN dbo.p_Publish_Offer_Bol ON p_Publish_Offer_Bol.ShopID = wd_Order_PrestaShop.ShopId")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//                                                                    AND p_Publish_Offer_Bol.SellerSKU = wd_Order_PrestaShop_Item.SKU")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//                        ) AS temp")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//                        LEFT OUTER JOIN dbo.r_OrderReturns WITH ( NOLOCK ) ON dbo.r_OrderReturns.WdOrderId = temp.WDOrderID")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//                                                                    AND dbo.r_OrderReturns.ShopId = temp.shopID")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//                                                                    AND dbo.r_OrderReturns.type = 1")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//                        INNER JOIN dbo.d_shopinfo ON dbo.d_shopinfo.shopID = temp.shopID")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v('//                        INNER JOIN dbo.x_platForm ON dbo.x_platForm.PID = dbo.d_shopinfo.blongsPlatform";')]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token preprocessor property"}},[t._v("#"),s("span",{pre:!0,attrs:{class:"token directive keyword"}},[t._v("endregion")])]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v('//                strSql = string.Format(strSql, ", wd_cs_ReturnOrder.Sub_Amt AS ReturnDiscount", @" LEFT JOIN ( SELECT  Ebp_Bill_Code ,')]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//                                        Goods_Id ,")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//                                        SUM(Sub_Amt) Sub_Amt ,")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//                                        MAX(OriginalShopId) OriginalShopId")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//                                FROM    wd_cs_ReturnOrder")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//                                WHERE   Goods_Id = -4")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//                                GROUP BY Ebp_Bill_Code ,")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//                                        Goods_Id")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//                              ) wd_cs_ReturnOrder ON Ebp_Bill_Code = temp.OrderId")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//                                                     AND OriginalShopId = temp.shopID")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//          --WHERE     temp.OrderId IN ( SELECT    Ebp_Bill_Code")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//          --                            FROM      wd_cs_ReturnOrder")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//          --                            WHERE     Goods_Id = -4 )")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v('//        ");')]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v('//                strSql = string.Format(strSql, "", "");')]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v('//                if (request.Params["GroupIds"].Length > 0)')]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//                {")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v('//                    strSql += @"')]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//                    JOIN (")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//                        SELECT  ec_CustomCategories_Item.BID")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//                        FROM    dbo.ec_CustomCategories")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//                                JOIN ec_CustomCategories ec_CustomCategories1 ON ec_CustomCategories1.TreeKey LIKE ( '%'")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//                                                                                      + ec_CustomCategories.TreeKey")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//                                                                                      + '%' )")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//                                JOIN dbo.ec_CustomCategories_Item ON ec_CustomCategories_Item.CCID = ec_CustomCategories1.CCID")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v('//                        WHERE   ec_CustomCategories.CCID = \'" + request.Params["GroupIds"] + @"\'')]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v('//                                AND ec_CustomCategories_Item.Type <> 2) cc ON cc.BID = temp.BID";')]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//                }")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v('//reportGroup += ",SKU";')]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n            "),s("span",{pre:!0,attrs:{class:"token class-name"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("string")])]),t._v(" sql "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("string")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Empty"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token class-name"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("string")])]),t._v(" otherFileds "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("string")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Empty"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("request"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Params"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"GroupIds"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Length "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" request"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Params"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"GroupIds"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("ToString")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"1"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                sql "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("@\"\n                WHERE     EXISTS ( SELECT 1\n                                         FROM   ( SELECT DISTINCT\n                                                    BID ,\n                                                    d_ProductResponsibleProgramDetail.ShopId ,\n                                                    CASE WHEN PlatFormType = 'BOL' THEN ''\n                                                         ELSE MarketplaceId\n                                                    END AS MarketplaceId ,\n                                                    CreateDate ,\n                                                    EndDate\n                                            FROM    dbo.d_ProductResponsibleProgram\n                                                    JOIN dbo.d_ProductResponsibleProgramDetail ON d_ProductResponsibleProgram.ProductResponsibleProgramId = d_ProductResponsibleProgramDetail.ProductResponsibleProgramId\n                                                    JOIN dbo.d_ShopAmazonToMarketplace ON d_ShopAmazonToMarketplace.ShopId = d_ProductResponsibleProgramDetail.ShopId\n                                                              AND d_ShopAmazonToMarketplace.MSiteId = d_ProductResponsibleProgram.MSiteId\n                                                    JOIN dbo.d_ProductResponsible_Item ON d_ProductResponsibleProgramDetail.ProductResponsibleProgramId = d_ProductResponsible_Item.ProductResponsibleProgramId\n                                                    WHERE d_ProductResponsible_Item.PRCId In\n                                                    (\n                                                        SELECT p1.PRCId FROM d_ProductResponsibleCategory p1 WHERE p1.PRCId = '\"")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" request"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Params"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"GroupIds"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("@\"'\n                                                        UNION ALL\n                                                        SELECT p2.PRCId FROM d_ProductResponsibleCategory p1\n                                                        INNER JOIN d_ProductResponsibleCategory p2 ON p2.pPRCId = p1.PRCId\n                                                        WHERE p1.PRCId = '\"")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" request"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Params"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"GroupIds"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('@"\'\n                                                    )\n                                                ) cc\n                                         WHERE  1=1\n                                                AND cc.BID = temp.BID\n                                                AND cc.ShopId = temp.shopID\n                                                AND cc.MarketplaceId = temp.MarketplaceId\n                                                AND ( ( cc.CreateDate IS NULL\n                                                        OR temp.PurchaseDate > cc.CreateDate\n                                                      )\n                                                      AND ( cc.EndDate IS NULL\n                                                            OR temp.PurchaseDate < cc.EndDate\n                                                          )\n                                                    ) )"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("string")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("IsNullOrEmpty")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("request"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Params"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"GroupIds"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("ToString")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("||")]),t._v(" request"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Params"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"GroupIds"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("ToString")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"1"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" request"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Params"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"needPRC"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"1"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                sql "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("@\"       LEFT JOIN ( SELECT DISTINCT\n                                                BID ,\n                                                d_ProductResponsible_Item.PRCId ,\n                                                    --d_ProductResponsibleCategory.Name,\n                                                d_ProductResponsibleProgramDetail.ShopId ,\n                                                CASE WHEN PlatFormType = 'BOL'\n                                                     THEN ''\n                                                     ELSE MarketplaceId\n                                                END AS MarketplaceId ,\n                                                CreateDate ,\n                                                EndDate\n                                       FROM     dbo.d_ProductResponsibleProgram\n                                                JOIN dbo.d_ProductResponsibleProgramDetail ON d_ProductResponsibleProgram.ProductResponsibleProgramId = d_ProductResponsibleProgramDetail.ProductResponsibleProgramId\n                                                JOIN dbo.d_ShopAmazonToMarketplace ON d_ShopAmazonToMarketplace.ShopId = d_ProductResponsibleProgramDetail.ShopId\n                                                              AND d_ShopAmazonToMarketplace.MSiteId = d_ProductResponsibleProgram.MSiteId\n                                                JOIN dbo.d_ProductResponsible_Item ON d_ProductResponsibleProgramDetail.ProductResponsibleProgramId = d_ProductResponsible_Item.ProductResponsibleProgramId\n                                                    --JOIN dbo.d_ProductResponsibleCategory ON d_ProductResponsibleCategory.PRCId = d_ProductResponsible_Item.PRCId\n                                                  --WHERE     d_ProductResponsible_Item.PRCId = '\"")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" request"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Params"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"GroupIds"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('@"\'\n                                     ) cc ON 1 = 1\n                                             AND cc.BID = temp.BID\n                                             AND cc.ShopId = temp.shopID\n                                             AND cc.MarketplaceId = temp.MarketplaceId\n                                             AND ( ( cc.CreateDate IS NULL\n                                                     OR temp.PurchaseDate > cc.CreateDate\n                                                   )\n                                                   AND ( cc.EndDate IS NULL\n                                                         OR temp.PurchaseDate < cc.EndDate\n                                                       )\n                                                 )"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                otherFileds "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"PRCId,"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n            "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n            strSql "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("string")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("Format")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("strSql"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" sql"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" otherFileds"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" strSpecialFields"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n            "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("request"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Params"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("AllKeys"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("Contains")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"NegativeGrossProfit"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" request"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Params"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"NegativeGrossProfit"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"true"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                tempWhereSql "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("@\" AND NOT EXISTS ( SELECT 1\n                                FROM dbo.ec_BaseInfo\n                                WHERE  BarcodeMark = 'L'\n                                            AND ec_BaseInfo.BID = a.BID\n                                            AND a.GrossProfit < 0 )\"")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("request"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Params"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("AllKeys"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("Contains")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"NegativeNAVY"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("request"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Params"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"NegativeNAVY"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"true"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("||")]),t._v(" request"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Params"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"NegativeNAVY"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"on"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                tempWhereSql "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('" AND IsNAVY = 0 "')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("request"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Params"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("AllKeys"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("Contains")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"ContainNAVY"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("request"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Params"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"ContainNAVY"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"true"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("||")]),t._v(" request"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Params"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"ContainNAVY"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"on"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                tempWhereSql "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('" AND IsNAVY = 1 "')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n            "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("string")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("IsNullOrEmpty")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("request"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Params"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"BID"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                tempWhereSql "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('" and BID = \'"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" request"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Params"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"BID"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("Trim")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"\'"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 销售类型")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("string")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("IsNullOrEmpty")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("request"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Params"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"selSalesType"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" request"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Params"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"selSalesType"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"-1"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                tempWhereSql "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('" and type = "')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" request"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Params"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"selSalesType"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("Trim")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("request"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Params"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"ifDetailDataLoad"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"0"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token class-name"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("string")])]),t._v(" leftJoinTable "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("request"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Params"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"needPRC"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"1"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                    reportGroup "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('",a.PRCId,d_ProductResponsibleCategory.Name"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                    leftJoinTable "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('" left JOIN dbo.d_ProductResponsibleCategory ON d_ProductResponsibleCategory.PRCId = a.PRCId"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("reportGroup"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("Contains")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"SKU"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v("reportGroup"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("Contains")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Cname"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n                    reportGroup "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('",Cname"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                strSql "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("string")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("Format")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('@"SELECT {0},SUM(Quantity) AS Quantity,SUM(ReturnQuantity) AS ReturnQuantity,SUM(SalesQuantity) AS SalesQuantity,CAST(IIF(SUM(SalesQuantity)=0,0,SUM(ReturnQuantity)*100/SUM(SalesQuantity)) as decimal(18, 2)) AS ReturnRates,ROUND(SUM(TotalPrice),2) TotalPrice,ROUND(SUM(ReturnMoney),2) AS ReturnMoney,ROUND(SUM(OrderRemovalFee),2) AS OrderRemovalFee,ROUND(SUM(TotalPrice-ReturnMoney),2) AS SalesAmount,ROUND(SUM(AdditionalCostPrice),2) AS AdditionalCostPrice ,ROUND(SUM(TotalAdditionalCostPrice),2) AS TotalAdditionalCostPrice ,ROUND(SUM(GrossProfit),2) AS GrossProfit,CASE WHEN SUM(TotalPrice-ReturnMoney)=0 THEN 0 else ROUND(CASE WHEN (SUM(GrossProfit)<0 AND SUM(TotalPrice-ReturnMoney)<0) THEN (-(SUM(GrossProfit)/SUM(TotalPrice-ReturnMoney))) ELSE SUM(GrossProfit)/SUM(TotalPrice-ReturnMoney) END, 4) * 100 end GrossProfitMargin,COALESCE(SUM(NAVYPrice),0) NAVYPrice,CASE WHEN SUM(TotalPrice)=0 THEN 0 else CAST(ISNULL(SUM(ReturnMoney),0)*100/SUM(TotalPrice) AS decimal(18,2)) end SalesReturnRate,ROUND(SUM(PurchaseCost),2) AS PurchaseCost FROM ("')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" strSql "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('") a {2} WHERE {1} GROUP BY {0} "')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" reportGroup"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" _sbWhere "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" tempWhereSql"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" leftJoinTable"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v("reportGroup"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("Contains")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"SKU"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n                    reportGroup "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('",SKU,Cname"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                strSql "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("string")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("Format")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('@"SELECT {0},OrderId,ROUND(TotalPrice,2) AS TotalPrice,ROUND(ReturnMoney,2) AS ReturnMoney,ROUND(OrderRemovalFee,2) AS OrderRemovalFee,ROUND(TotalPrice-ReturnMoney,2) AS SalesAmount,ROUND(AdditionalCostPrice,2) AS AdditionalCostPrice, ROUND(TotalAdditionalCostPrice,2) AS TotalAdditionalCostPrice,ROUND(ISNULL(GrossProfit,0),2) AS GrossProfit,ROUND(ISNULL(GrossProfitMargin,0),4)*100 AS GrossProfitMargin,ISNULL(NAVYPrice,0) NAVYPrice,CASE WHEN TotalPrice=0 THEN 0 else ROUND(ReturnMoney/TotalPrice,4)*100 end SalesReturnRate,ProgramShippingCosts,VolumeCost,Quantity,ROUND(PurchaseCost,2) AS PurchaseCost,FulfillmentChannel,TaxRate ,Commission,BID,MarketplaceId,a.ShopName,CostPrice,CostDiscount,ExchangeRate,NewGoodsDiscount,QualityDiscount,SupportDiscount,SpecialDiscount,FixedFee,IsNAVY,Type,OrderType,ReturnManagementFee FROM ("')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" strSql "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('") a WHERE {1}"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" reportGroup"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" _sbWhere "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" tempWhereSql"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" strSql"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])])])])}),[],!1,null,null,null);s.default=e.exports}}]);